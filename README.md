# üé§ Whisper Transcription API

**–ú–Ω–æ–≥–æ-GPU –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π API –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ –∞—É–¥–∏–æ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –æ—á–µ—Ä–µ–¥–∏, –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–µ–π –∏ —É–ª—É—á—à–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ GPT.**

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**  
   Python 3.8+, `fastapi`, `uvicorn`, `torch`, `openai-whisper`, `g4f`, `jinja2` –∏ –¥—Ä.

2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:**
   
uvicorn app.main:app --reload

 3. **–û—Ç–∫—Ä–æ–π—Ç–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:**  
[http://localhost:8000/](http://localhost:8000/)

---

## üìö –û–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–æ—Ç API –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞—Ç—å –∞—É–¥–∏–æ—Ñ–∞–π–ª—ã —Å –ø–æ–º–æ—â—å—é Whisper –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö GPU, —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–æ–π –º–æ–¥–µ–ª–µ–π, –æ—á–µ—Ä–µ–¥—å—é –∑–∞–¥–∞—á –∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º —É–ª—É—á—à–µ–Ω–∏–µ–º —Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ GPT.  
–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–¥–∞—á, GPU, –ª–æ–≥–æ–≤ –∏ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–µ–π.

---

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

app/

‚îú‚îÄ‚îÄ main.py

‚îú‚îÄ‚îÄ core/

‚îÇ ‚îú‚îÄ‚îÄ task.py

‚îÇ ‚îú‚îÄ‚îÄ queue.py

‚îÇ ‚îú‚îÄ‚îÄ gpu.py

‚îÇ ‚îú‚îÄ‚îÄ model_manager.py

‚îÇ ‚îî‚îÄ‚îÄ utils.py

‚îú‚îÄ‚îÄ services/

‚îÇ ‚îî‚îÄ‚îÄ transcriber.py

‚îú‚îÄ‚îÄ static/

‚îÇ ‚îî‚îÄ‚îÄ style.css

‚îú‚îÄ‚îÄ templates/

‚îÇ ‚îî‚îÄ‚îÄ index.html


---

## üõ†Ô∏è –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á** —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö GPU
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–µ–π** Whisper (`tiny`, `base`, `small`, `medium`, `large-v2`, `large-v3`) –Ω–∞ –∫–∞–∂–¥—ã–π GPU
- **–£–ª—É—á—à–µ–Ω–∏–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞ —á–µ—Ä–µ–∑ GPT** (g4f/OpenAI)
- **–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º –æ—á–µ—Ä–µ–¥–∏, GPU, –ª–æ–≥–æ–≤ –∏ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–µ–π
- **REST API** –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å n8n –∏ –¥—Ä—É–≥–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏

---

## üîó –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã API

### `POST /api/transcribe`

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–ü–æ—Å—Ç–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ –≤ –æ—á–µ—Ä–µ–¥—å.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã (multipart/form-data):**
| –ü–æ–ª–µ                   | –¢–∏–ø           | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ | –û–ø–∏—Å–∞–Ω–∏–µ                                  |
|------------------------|---------------|--------------|--------------------------------------------|
| `file`                 | file          | –¥–∞           | –ê—É–¥–∏–æ—Ñ–∞–π–ª –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏                |
| `model_name`           | string        | –Ω–µ—Ç          | –ù–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ Whisper (`base` –ø–æ —É–º–æ–ª—á.) |
| `initial_prompt`       | string        | –Ω–µ—Ç          | –ù–∞—á–∞–ª—å–Ω—ã–π prompt –¥–ª—è –º–æ–¥–µ–ª–∏                |
| `upgrade_transcribation` | bool        | –Ω–µ—Ç          | –£–ª—É—á—à–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ GPT                 |
| `up_speed`             | float         | –Ω–µ—Ç          | –£—Å–∫–æ—Ä–µ–Ω–∏–µ –∞—É–¥–∏–æ (1.0 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)         |

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
curl -X POST http://localhost:8000/api/transcribe
-F "file=@audio.mp3"
-F "model_name=base"
-F "upgrade_transcribation=true"

**–û—Ç–≤–µ—Ç:**
{
"task_id": "76a30f8c-644a-4fca-b9a8-9e69225affac"
}

---

### `GET /api/status/{task_id}`

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–¥–∞—á–∏.

**–û—Ç–≤–µ—Ç:**
| –ü–æ–ª–µ      | –¢–∏–ø     | –û–ø–∏—Å–∞–Ω–∏–µ                                |
|-----------|---------|------------------------------------------|
| status    | string  | queued / processing / done / error       |
| result    | string  | –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ (–µ—Å–ª–∏ –≥–æ—Ç–æ–≤–æ)     |
| error     | string  | –û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)              |
| ...       | ...     | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (—Ç–∞–π–º–∏–Ω–≥–∏, GPU –∏ –¥—Ä.)|

**–ü—Ä–∏–º–µ—Ä:**
{
"status": "done",
"result": "–¢–µ–∫—Å—Ç –≤–∞—à–µ–π —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏...",
"task_id": "76a30f8c-644a-4fca-b9a8-9e69225affac"
}

---

### `GET /api/queue`

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–¥–∞—á–∞—Ö –≤ –æ—á–µ—Ä–µ–¥–∏, –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ, –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –∏ —Å –æ—à–∏–±–∫–∞–º–∏.

**–û—Ç–≤–µ—Ç:**
{
"queue": [{ "id": "...", "filename": "...", "created_at": "..." }],
"processing": [{ "id": "...", "filename": "...", "gpu_id": 0 }],
"completed": [{ "id": "...", "filename": "...", "completed_at": "..." }],
"failed": [{ "id": "...", "filename": "...", "error": "..." }]
}

---

### `GET /api/gpus`

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö GPU –∏ –∏—Ö –∑–∞–≥—Ä—É–∑–∫–µ.

**–û—Ç–≤–µ—Ç:**
[
{
"id": 0,
"name": "NVIDIA RTX 4090",
"memory_total_mb": 24576,
"memory_used_mb": 1024,
"utilization_gpu": 12
},
...
]

---

### `GET /api/model_status`

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–°—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–µ–π –Ω–∞ –∫–∞–∂–¥–æ–º GPU.

**–û—Ç–≤–µ—Ç:**
{
"0": {
"base": "loaded",
"medium": "loading",
"large-v2": "error"
},
"1": {
"base": "loaded",
"medium": "loaded"
}
}

---

### `GET /api/logs`

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è –∏ –ª–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã (–¥–æ 200 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–ø–∏—Å–µ–π).

**–û—Ç–≤–µ—Ç:**
[
{ "time": "2025-07-14T09:55:24Z", "msg": "Task ... completed on GPU 0" },
...
]

---

### `GET /`

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤.

---

## üñ•Ô∏è –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

- –ó–∞–≥—Ä—É–∑–∫–∞ –∞—É–¥–∏–æ—Ñ–∞–π–ª–∞ –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø—Ä—è–º–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—á–µ—Ä–µ–¥–∏, —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞–¥–∞—á, GPU –∏ –ª–æ–≥–æ–≤
- –ö—Ä–∞—Å–∏–≤—ã–π —Ç—ë–º–Ω—ã–π –¥–∏–∑–∞–π–Ω, –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å n8n

1. **HTTP Request node**  
   - –ú–µ—Ç–æ–¥: `POST`
   - URL: `http://<your_host>:8000/api/transcribe`
   - Send Binary Data: `true`
   - Binary Property: `file`
   - Add Form Fields: `model_name`, `upgrade_transcribation`, `up_speed` –∏ –¥—Ä.

2. **HTTP Request node**  
   - –ú–µ—Ç–æ–¥: `GET`
   - URL: `http://<your_host>:8000/api/status/{{$json["task_id"]}}`
   - Polling –¥–æ —Å—Ç–∞—Ç—É—Å–∞ `done`

---

## ‚öôÔ∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

- **–û—á–µ—Ä–µ–¥—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ –ø–∞–º—è—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞**
- **–í–æ—Ä–∫–µ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ GPU**
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏ –∑–∞–¥–∞—á**
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ ‚Äî –∑–∞–¥–∞—á–∏ –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞**
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** API –ø—É–±–ª–∏—á–Ω—ã–π, –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å–µ—Ç–∏)

---

## üõ°Ô∏è –í–∞–∂–Ω–æ

> **–í–Ω–∏–º–∞–Ω–∏–µ:**  
> API –Ω–µ –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ!  
> –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –∑–∞—â–∏—Ç—É –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞.
